local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

--// ================= CONFIG VERIFIED ================= //--
local CustomIconSettings = {
    VerifiedEmoji = "ÓÄÄ",
    PremiumEmoji = "ÓÄÅ",
    UserIDs = {
        [4837824706] = true,
        [10239055123] = true,
    }
}
--// ==================================================== //--

--// ScreenGui Setup
local TPplayersUI = Instance.new("ScreenGui")
TPplayersUI.Name = "Goto PlayersUI"
TPplayersUI.DisplayOrder = 9999
TPplayersUI.ResetOnSpawn = false
TPplayersUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
TPplayersUI.IgnoreGuiInset = true
TPplayersUI.Enabled = false
TPplayersUI.Parent = PlayerGui

--// Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 300, 0, 320)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -160)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.BackgroundTransparency = 0.1
mainFrame.Parent = TPplayersUI

local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 10)
uiCorner.Parent = mainFrame

--// Close Button
local closeBtn = Instance.new("TextButton")
closeBtn.Name = "CloseButton"
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -35, 0, 5)
closeBtn.BackgroundTransparency = 1
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.new(1, 1, 1)
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 18
closeBtn.ZIndex = 10
closeBtn.Parent = mainFrame

closeBtn.MouseButton1Click:Connect(function()
	TPplayersUI.Enabled = false
end)

--// Title
local title = Instance.new("TextLabel")
title.Name = "TitleLabel"
title.Text = "PANEL TELEPORT"
title.Size = UDim2.new(1, -70, 0, 30)
title.Position = UDim2.new(0, 10, 0, 5)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.GothamBold
title.TextSize = 15
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = mainFrame

--// Refresh Button
local refreshBtn = Instance.new("ImageButton")
refreshBtn.Name = "RefreshButton"
refreshBtn.Image = "rbxassetid://86084882582277"
refreshBtn.Size = UDim2.new(0, 22, 0, 22)
refreshBtn.Position = UDim2.new(1, -65, 0, 8)
refreshBtn.BackgroundTransparency = 1
refreshBtn.ZIndex = 10
refreshBtn.Parent = mainFrame

--// Search Box
local searchBox = Instance.new("TextBox")
searchBox.Name = "SearchBox"
searchBox.PlaceholderText = "Search players..."
searchBox.Text = "" 
searchBox.Size = UDim2.new(1, -20, 0, 30)
searchBox.Position = UDim2.new(0, 10, 0, 40)
searchBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
searchBox.TextColor3 = Color3.new(1, 1, 1)
searchBox.Font = Enum.Font.Gotham
searchBox.TextSize = 13
searchBox.Parent = mainFrame
Instance.new("UICorner", searchBox).CornerRadius = UDim.new(0, 6)

--// Scroll List
local scroll = Instance.new("ScrollingFrame")
scroll.Name = "PlayerScroll"
scroll.Size = UDim2.new(1, -20, 1, -95)
scroll.Position = UDim2.new(0, 10, 0, 80)
scroll.BackgroundTransparency = 1
scroll.ScrollBarThickness = 4
scroll.Parent = mainFrame

local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 5)
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Parent = scroll

--// Variables
local cam = workspace.CurrentCamera
local playerCards = {}
local currentWatchTarget = nil
local globalWatchBtn = nil
local diedConn = nil
local activeTween = nil

local function resetGlobalWatch()
    if Player.Character and Player.Character:FindFirstChild("Humanoid") then
        cam.CameraSubject = Player.Character.Humanoid
    end
    if globalWatchBtn then globalWatchBtn.Text = "üëÄ" end
    if diedConn then diedConn:Disconnect() diedConn = nil end
    currentWatchTarget = nil
    globalWatchBtn = nil
end

--// Function Create Card
local function createPlayerCard(plr)
    if not plr or playerCards[plr] then return end
    
    local card = Instance.new("Frame")
    card.Name = plr.Name
    card.Size = UDim2.new(1, -5, 0, 50)
    card.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    card.Parent = scroll
    Instance.new("UICorner", card).CornerRadius = UDim.new(0, 8)

    local isFriend = false
    if plr == Player then
        card.LayoutOrder = -2
    elseif Player:IsFriendsWith(plr.UserId) then
        card.LayoutOrder = -1
        isFriend = true
    else
        card.LayoutOrder = 0
    end

    local thumb = Instance.new("ImageLabel")
    thumb.Name = "AvatarThumbnail"
    thumb.Size = UDim2.new(0, 38, 0, 38)
    thumb.Position = UDim2.new(0, 6, 0.5, 0)
    thumb.AnchorPoint = Vector2.new(0, 0.5)
    thumb.BackgroundTransparency = 1
    pcall(function()
        thumb.Image = Players:GetUserThumbnailAsync(plr.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48)
    end)
    thumb.Parent = card

    if isFriend then
        local badge = Instance.new("ImageLabel")
        badge.Name = "BadgeIcon"
        badge.Size = UDim2.new(0, 14, 0, 14)
        badge.Position = UDim2.new(1, 0, 1, 0)
        badge.AnchorPoint = Vector2.new(1, 1)
        badge.BackgroundTransparency = 1
        badge.Image = "rbxassetid://101269177900865"
        badge.ZIndex = 5
        badge.Parent = thumb
    end

    --// LOGIC ICON (VERIFIED & PREMIUM)
    local nameSuffix = ""
    
    -- Cek Verified Asli atau List Custom
    if plr.HasVerifiedBadge or CustomIconSettings.UserIDs[plr.UserId] then
        nameSuffix = nameSuffix .. CustomIconSettings.VerifiedEmoji
    end
    
    -- Cek Premium
    if plr.MembershipType == Enum.MembershipType.Premium then
        nameSuffix = nameSuffix .. CustomIconSettings.PremiumEmoji
    end

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Name = "NameLabel"
    local nameColor = (plr == Player) and "#55FFFF" or "#FFFFFF"
    
    -- Teks digabung nempel
    nameLabel.Text = "<b><font color='"..nameColor.."'>" .. plr.DisplayName .. nameSuffix .. "</font></b>\n<font color='#AAAAAA'>@" .. plr.Name .. "</font>"
    nameLabel.RichText = true
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Size = UDim2.new(1, -165, 1, 0)
    nameLabel.Position = UDim2.new(0, 50, 0, 0)
    nameLabel.Font = Enum.Font.Gotham
    nameLabel.TextColor3 = Color3.new(1, 1, 1)
    nameLabel.TextSize = 10
    nameLabel.BackgroundTransparency = 1
    nameLabel.Parent = card

    -- Buttons (TP, TW, Watch)
    local tpBtn = Instance.new("TextButton")
    tpBtn.Name = "TeleportButton"
    tpBtn.Size = UDim2.new(0, 35, 0, 22)
    tpBtn.Position = UDim2.new(1, -125, 0.5, -11)
    tpBtn.Text = "TP"
    tpBtn.BackgroundColor3 = Color3.fromRGB(40, 100, 40)
    tpBtn.TextColor3 = Color3.new(1, 1, 1)
    tpBtn.Font = Enum.Font.GothamBold
    tpBtn.TextSize = 10
    tpBtn.Parent = card
    Instance.new("UICorner", tpBtn).CornerRadius = UDim.new(0, 5)

    tpBtn.MouseButton1Click:Connect(function()
        if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            if activeTween then activeTween:Cancel() end
            Player.Character:PivotTo(plr.Character.HumanoidRootPart.CFrame * CFrame.new(0, 3, 0))
            TPplayersUI.Enabled = false
        end
    end)

    local twBtn = Instance.new("TextButton")
    twBtn.Name = "TweenButton"
    twBtn.Size = UDim2.new(0, 35, 0, 22)
    twBtn.Position = UDim2.new(1, -85, 0.5, -11)
    twBtn.Text = "TW"
    twBtn.BackgroundColor3 = Color3.fromRGB(100, 80, 0)
    twBtn.TextColor3 = Color3.new(1, 1, 1)
    twBtn.Font = Enum.Font.GothamBold
    twBtn.TextSize = 10
    twBtn.Parent = card
    Instance.new("UICorner", twBtn).CornerRadius = UDim.new(0, 5)

    twBtn.MouseButton1Click:Connect(function()
        if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            TPplayersUI.Enabled = false
            local hrp = Player.Character.HumanoidRootPart
            local dist = (hrp.Position - plr.Character.HumanoidRootPart.Position).Magnitude
            activeTween = TweenService:Create(hrp, TweenInfo.new(dist/150, Enum.EasingStyle.Linear), {CFrame = plr.Character.HumanoidRootPart.CFrame * CFrame.new(0, 3, 0)})
            activeTween:Play()
        end
    end)

    local watchBtn = Instance.new("TextButton")
    watchBtn.Name = "WatchButton"
    watchBtn.Size = UDim2.new(0, 35, 0, 22)
    watchBtn.Position = UDim2.new(1, -45, 0.5, -11)
    watchBtn.Text = "üëÄ"
    watchBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 100)
    watchBtn.TextColor3 = Color3.new(1, 1, 1)
    watchBtn.Font = Enum.Font.GothamBold
    watchBtn.TextSize = 10
    watchBtn.Parent = card
    Instance.new("UICorner", watchBtn).CornerRadius = UDim.new(0, 5)

    watchBtn.MouseButton1Click:Connect(function()
        if currentWatchTarget == plr then resetGlobalWatch()
        else
            if currentWatchTarget ~= nil then resetGlobalWatch() end
            if plr.Character and plr.Character:FindFirstChild("Humanoid") then
                cam.CameraSubject = plr.Character.Humanoid
                currentWatchTarget = plr
                globalWatchBtn = watchBtn
                watchBtn.Text = "‚õî"
                diedConn = plr.Character.Humanoid.Died:Connect(resetGlobalWatch)
            end
        end
    end)
    
    if plr == Player then
        tpBtn.Visible = false
        twBtn.Visible = false
        watchBtn.Visible = false
    end

    playerCards[plr] = card
end

local function updateList()
    for plr, card in pairs(playerCards) do
        if not Players:FindFirstChild(plr.Name) then
            if currentWatchTarget == plr then resetGlobalWatch() end
            card:Destroy()
            playerCards[plr] = nil
        end
    end
    for _, plr in ipairs(Players:GetPlayers()) do
        if not playerCards[plr] then
            createPlayerCard(plr)
        end
    end
    scroll.CanvasSize = UDim2.new(0,0,0, listLayout.AbsoluteContentSize.Y)
end

Players.PlayerRemoving:Connect(function(plr)
    if playerCards[plr] then
        if currentWatchTarget == plr then resetGlobalWatch() end
        playerCards[plr]:Destroy()
        playerCards[plr] = nil
    end
    updateList()
end)

Players.PlayerAdded:Connect(function()
    task.wait(0.5)
    updateList()
end)

refreshBtn.MouseButton1Click:Connect(function()
    TweenService:Create(refreshBtn, TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Rotation = refreshBtn.Rotation - 360}):Play()
    resetGlobalWatch()
    for _, c in pairs(playerCards) do c:Destroy() end
    playerCards = {}
    task.wait(0.1)
    updateList()
end)

searchBox:GetPropertyChangedSignal("Text"):Connect(function()
    local t = searchBox.Text:lower()
    for plr, card in pairs(playerCards) do
        card.Visible = (plr.Name:lower():find(t) or plr.DisplayName:lower():find(t) or t == "")
    end
end)

UserInputService.InputBegan:Connect(function(i, p)
    if not p and i.KeyCode == Enum.KeyCode.P then TPplayersUI.Enabled = not TPplayersUI.Enabled end
end)

updateList()
