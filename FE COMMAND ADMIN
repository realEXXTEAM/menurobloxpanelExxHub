--[[
    FE ADMIN COMMANDS (UPDATE)
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local TeleportService = game:GetService("TeleportService")
local UserInputService = game:GetService("UserInputService")
local SoundService = game:GetService("SoundService")
local Debris = game:GetService("Debris")
local TweenService = game:GetService("TweenService") 
local LocalPlayer = Players.LocalPlayer

local prefix = "!"
-- STATE VARIABLES
local isFlying = false 
local isNoclipping = false
local isInfiniteJump = false
local isDoubleJump = false
local hasDoubleJumped = false 
local isAntiIdle = false 
local isFrozen = false 
-- isSuperRing dan isBlackhole dihapus
local flySpeed = 50

-- Part Control Variables (Dihapus/Dibersihkan)
local flingTarget = nil
local angle = 0 -- Variabel ini tetap ada, tapi tidak terpakai lagi kecuali untuk fling

-- Support Variables
local loopJoining = false
local targetPlayer = nil
local noclipConnection = nil 
local antiIdleConnection = nil
local kamuiFolder = nil 
local lastPos = nil 
local activeAnimTracks = {} 

-- Config Visual Kamui
local roomSize = 800 
local arenaSize = 120 
local wallThickness = 10
local notifSoundId = "rbxassetid://1862047553" 

-- ==========================================
-- NOTIFICATION & SOUND SYSTEM (CUSTOM UI)
-- ==========================================
local function playSound()
    local sound = Instance.new("Sound")
    sound.Name = "GeminiNotifSound"
    
    sound.SoundId = notifSoundId
    sound.Volume = 2 
    sound.Parent = SoundService
    sound:Play()
    Debris:AddItem(sound, 2)
end

local function showNotificationUI(title, text)
    playSound() 
    
    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
    local NotificationName = "CustomNotify_" .. math.random(1, 1000)

    local sg = Instance.new("ScreenGui")
    sg.Name = NotificationName
    sg.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    sg.Parent = PlayerGui
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 200, 0, 60)
    frame.Position = UDim2.new(1, 10, 0.5, -30) 
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    frame.BackgroundTransparency = 0.1 
    frame.BorderSizePixel = 0
    frame.Parent = sg
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 8)
    UICorner.Parent = frame
    
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.fromRGB(255, 255, 255)
    UIStroke.Thickness = 1
    UIStroke.Parent = frame

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Text = title
    titleLabel.Size = UDim2.new(1, 0, 0, 25)
    titleLabel.Position = UDim2.new(0, 0, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 16
    titleLabel.TextWrapped = true
    titleLabel.Parent = frame
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Text = text
    textLabel.Size = UDim2.new(1, -10, 0, 30)
    textLabel.Position = UDim2.new(0.5, 0, 0, 25) 
    textLabel.AnchorPoint = Vector2.new(0.5, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    textLabel.Font = Enum.Font.Code
    textLabel.TextSize = 13
    textLabel.TextWrapped = true
    textLabel.Parent = frame
    
    local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out)
    
    local targetPosition = UDim2.new(1, -210, 0.5, -30) 

    local enterTween = TweenService:Create(frame, tweenInfo, {Position = targetPosition})
    enterTween:Play()
    
    enterTween.Completed:Wait()
    task.wait(2) 
    
    local exitTweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Exponential, Enum.EasingDirection.In)
    local exitTween = TweenService:Create(frame, exitTweenInfo, {Position = UDim2.new(1, 10, 0.5, -30)}) 
    exitTween:Play()
    
    exitTween.Completed:Wait()
    
    if sg.Parent then
        sg:Destroy()
    end
end

local function notify(title, text)
    -- Menjalankan UI di thread terpisah agar tidak memblokir command
    task.spawn(showNotificationUI, title, text)
end
-- END NOTIFICATION SYSTEM

local function getPlayer(name)
    local lowerName = string.lower(name)
    for _, p in pairs(Players:GetPlayers()) do
        if string.lower(p.Name):sub(1, #lowerName) == lowerName or 
           string.lower(p.DisplayName):sub(1, #lowerName) == lowerName then
            return p
        end
    end
    return nil
end

-- ==========================================
-- LOGIC: ANIMATION & FREEZE
-- ==========================================

local function stopAllActiveAnimations()
    for _, track in pairs(activeAnimTracks) do 
        pcall(function() track:Stop() end)
    end
    activeAnimTracks = {}
    notify("Animation", "All Animations Cleared")
end

local function setFreeze(state)
    local char = LocalPlayer.Character
    local hum = char and char:FindFirstChild("Humanoid")
    local root = char and char:FindFirstChild("HumanoidRootPart")
    
    if not hum or not root then 
        notify("Error", "Character not ready or not spawned.")
        return 
    end
    
    isFrozen = state
    
    if state then
        if isFlying then isFlying = false; setNoclip(false); end 
        if isNoclipping then isNoclipping = false; setNoclip(false); end
        
        stopAllActiveAnimations() 
        
        root.Anchored = true
        hum.PlatformStand = true
        hum.WalkSpeed = 0 
        
        notify("Status", "Frozen: Movement Disabled")
    else
        root.Anchored = false
        hum.PlatformStand = false
        hum.WalkSpeed = 16 
        
        notify("Status", "Unfrozen: Movement Restored")
    end
end

-- ==========================================
-- LOGIC: PART CONTROL & JUMP
-- ==========================================
RunService.Heartbeat:Connect(function()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local root = char.HumanoidRootPart
    
    -- Logika SuperRing dan Blackhole dihapus di sini
    
    if flingTarget and flingTarget.Character and flingTarget.Character:FindFirstChild("HumanoidRootPart") then
        local tRoot = flingTarget.Character.HumanoidRootPart
        root.Velocity = Vector3.new(9000, 9000, 9000)
        root.RotVelocity = Vector3.new(9000, 9000, 9000)
        root.CFrame = tRoot.CFrame * CFrame.new(0, -2, 0)
        if char:FindFirstChild("Humanoid") then char.Humanoid:ChangeState(Enum.HumanoidStateType.Physics) end
    end
end)

UserInputService.JumpRequest:Connect(function()
    local char = LocalPlayer.Character
    local hum = char and char:FindFirstChild("Humanoid")
    
    if hum and hum.Health > 0 and not isFrozen then 
        if isInfiniteJump then hum:ChangeState(Enum.HumanoidStateType.Jumping)
        elseif isDoubleJump then
            if hum:GetState() == Enum.HumanoidStateType.Freefall and not hasDoubleJumped then
                hum:ChangeState(Enum.HumanoidStateType.Jumping);
                hasDoubleJumped = true 
            end
        end
    end
end)

local function hookChar(char)
    if char then
        local hum = char:WaitForChild("Humanoid", 10)
        if hum then 
            hum.StateChanged:Connect(function(old, new) 
                if new == Enum.HumanoidStateType.Landed then 
                    hasDoubleJumped = false 
                end 
            end) 
        end
    end
end
LocalPlayer.CharacterAdded:Connect(hookChar)
if LocalPlayer.Character then hookChar(LocalPlayer.Character) end

-- ==========================================
-- SYSTEM LOGIC
-- ==========================================

local function setNoclip(state)
    if noclipConnection then noclipConnection:Disconnect(); noclipConnection = nil end
    if state then
        noclipConnection = RunService.Stepped:Connect(function()
            if LocalPlayer.Character then
                for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
                    if part:IsA("BasePart") and part.CanCollide == true then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        if LocalPlayer.Character then
            for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
                if part:IsA("BasePart") then part.CanCollide = true end
            end
        end
    end
end

local function startFly(speed)
    local char = LocalPlayer.Character
    if not char then return end
    
    if isFrozen then
        notify("Error", "Unfreeze before flying!")
        return
    end

    local root = char:WaitForChild("HumanoidRootPart", 5)
    local humanoid = char:WaitForChild("Humanoid", 5)
    if not root or not humanoid then return end
    setNoclip(true);
    humanoid.PlatformStand = true
    local bodyGyro = Instance.new("BodyGyro", root);
    local bodyVel = Instance.new("BodyVelocity", root)
    bodyGyro.P = 9e4; bodyGyro.maxTorque = Vector3.new(9e9, 9e9, 9e9);
    bodyGyro.cframe = root.CFrame
    bodyVel.velocity = Vector3.new(0, 0, 0);
    bodyVel.maxForce = Vector3.new(9e9, 9e9, 9e9)
    task.spawn(function()
        while isFlying and char.Humanoid.Health > 0 and not isFrozen do
            local camera = Workspace.CurrentCamera; bodyGyro.cframe = camera.CFrame
            local moveVector = require(LocalPlayer:WaitForChild("PlayerScripts").PlayerModule):GetControls():GetMoveVector()
            bodyVel.velocity = ((camera.CFrame.LookVector * speed) * (moveVector.Z * -1)) + ((camera.CFrame.RightVector * speed) * (moveVector.X))
            local userInput = game:GetService("UserInputService")
            if userInput:IsKeyDown(Enum.KeyCode.Space) then bodyVel.velocity = bodyVel.velocity + Vector3.new(0, speed, 0)
            elseif userInput:IsKeyDown(Enum.KeyCode.LeftControl) then bodyVel.velocity = bodyVel.velocity - Vector3.new(0, speed, 0) end
            RunService.RenderStepped:Wait()
        end
        if bodyGyro then bodyGyro:Destroy() end; if bodyVel then bodyVel:Destroy() end
        if not isFlying then if humanoid then humanoid.PlatformStand = false end;
            setNoclip(false) end
    end)
end

local function setAntiIdle(state)
    local char = LocalPlayer.Character
    local hum = char and char:FindFirstChild("Humanoid")

    isAntiIdle = state
    if antiIdleConnection then
        antiIdleConnection:Disconnect()
        antiIdleConnection = nil
    end

    if state then
        if hum then
            antiIdleConnection = RunService.RenderStepped:Connect(function()
                if Workspace.CurrentCamera.CameraSubject ~= hum then
                    Workspace.CurrentCamera.CameraSubject = hum
                end
                
                if hum:GetState() == Enum.HumanoidStateType.Idle then
                    hum:ChangeState(Enum.HumanoidStateType.Running)
                end
            end)
        end
        notify("Status", "Anti-AFK ON")
    else
        if hum and Workspace.CurrentCamera.CameraSubject == hum then 
            Workspace.CurrentCamera.CameraSubject = hum
        end
        notify("Status", "Anti-AFK OFF")
    end
end

-- Fungsi stopPartControl dihapus karena sudah tidak diperlukan

local function showHelpMenu()
    local gui = LocalPlayer.PlayerGui:FindFirstChild("AdminUI_NoThrone")
    if gui then 
        gui.Enabled = true
        playSound()
        return 
    end

    -- START CUSTOM UI CREATION
    local sg = Instance.new("ScreenGui")
    sg.Name = "AdminUI_NoThrone"
    sg.Parent = LocalPlayer.PlayerGui
    sg.ResetOnSpawn = false 

    local frame = Instance.new("Frame")
    frame.Name = "MainFrame"
    frame.Size = UDim2.new(0, 250, 0, 270) 
    frame.Position = UDim2.new(0.5, -125, 0.5, -155) 
    frame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
    frame.BorderSizePixel = 0
    frame.BackgroundTransparency = 0.05
    frame.Parent = sg
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = frame

    local title = Instance.new("TextLabel")
    title.Text = "COMMANDS"
    title.Size = UDim2.new(1, -60, 0, 40) 
    title.Position = UDim2.new(0, 20, 0, 0) 
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 20
    title.Parent = frame
    
    local closeBtn = Instance.new("TextButton")
    closeBtn.Text = "X"
    closeBtn.Size = UDim2.new(0, 40, 0, 40)
    closeBtn.Position = UDim2.new(1, -40, 0, 0) 
    closeBtn.BackgroundColor3 = Color3.fromRGB(200, 40, 40) 
    closeBtn.BackgroundTransparency = 1 
    closeBtn.TextColor3 = Color3.fromRGB(255, 40, 40) 
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.TextSize = 20
    closeBtn.Parent = frame
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = closeBtn

    closeBtn.MouseButton1Click:Connect(function() 
        sg.Enabled = false 
        playSound()
    end)


    local line = Instance.new("Frame")
    line.Size = UDim2.new(1, -20, 0, 1)
    line.Position = UDim2.new(0, 10, 0, 40)
    line.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    line.BorderSizePixel = 0
    line.Parent = frame

    local scroll = Instance.new("ScrollingFrame")
    scroll.Name = "CmdScroll"
    scroll.Size = UDim2.new(1, -20, 1, -60) 
    scroll.Position = UDim2.new(0, 10, 0, 50)
    scroll.BackgroundTransparency = 1
    scroll.BorderSizePixel = 0
    scroll.ScrollBarThickness = 6
    scroll.ScrollBarImageColor3 = Color3.fromRGB(200, 200, 200)
    scroll.CanvasSize = UDim2.new(0, 0, 0, 0) 
    scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y 
    scroll.Parent = frame

    local content = Instance.new("TextLabel")
    content.Size = UDim2.new(1, -10, 0, 0) 
    content.Position = UDim2.new(0, 5, 0, 0)
    content.BackgroundTransparency = 1
    content.TextXAlignment = Enum.TextXAlignment.Left
    content.TextYAlignment = Enum.TextYAlignment.Top
    content.TextColor3 = Color3.fromRGB(180, 180, 180)
    content.Font = Enum.Font.Code
    content.TextSize = 15 
    content.AutomaticSize = Enum.AutomaticSize.Y 
    content.Text = [[
[!fly speed]     - Set Fly Speed
[!unfly]         - Stop Flying
[!noclip]        - Walk Through Walls
[!clip]          - Normal Collision
[!speed num]     - Set WalkSpeed
[!doublejump]    - Jump Twice
[!infjump]       - Spam Jump

[!freeze]        - Anchor Player
[!unfreeze]      - Restore Movement

[!spectate user] - View Player
[!unspectate]    - Reset View
[!invisible]     - Ghost Mode
[!visible]       - Visible Mode
[!playanim id]   - Play Anim ID
[!unpose]        - Stop All Animations

[!fling user]    - Launch Player
[!unfling]       - Stop Fling
-- COMMAND PART CONTROL DIHAPUS

[!hop]           - Server Hop
[!rejoin]        - Rejoin Server
[!job]           - Copy Job ID
[!joinjobid id]  - Join Job ID
[!goto user]     - TP to Player
[!join user]     - Join Target Server
[!follow user]   - Loop TP Stick
[!antiidle]      - Disable AFK
[!unantiidle]    - Enable AFK
[!kamui]         - Void Box Arena
[!unkamui]       - Return to World
[!cmds / !]      - Open Menu
]]
    content.Parent = scroll
    
    playSound() 
end
-- END CUSTOM UI CREATION

LocalPlayer.CharacterAdded:Connect(function(newChar) 
    task.wait(1); 
    if isFlying then startFly(flySpeed) end; 
    if isNoclipping and not isFlying then setNoclip(true) end 
    if isFrozen then setFreeze(true) end 
end)

-- COMMAND HANDLER
LocalPlayer.Chatted:Connect(function(msg)
    local args = string.split(msg, " ")
    local cmd = string.lower(args[1])
    
    if cmd == prefix.."cmds" or cmd == prefix then showHelpMenu() 

    elseif cmd == prefix.."fly" then
        if isFrozen then notify("Error", "Unfreeze first!"); return end
        if args[2] then flySpeed = tonumber(args[2]) end; isFlying = true; startFly(flySpeed)
        notify("Status", "Fly Enabled - Speed: " .. flySpeed)
   
    elseif cmd == prefix.."unfly" then isFlying = false; local char = LocalPlayer.Character; if char and char:FindFirstChild("Humanoid") then char.Humanoid.PlatformStand = false end; setNoclip(false); notify("Status", "Fly Disabled")

    elseif cmd == prefix.."noclip" then isNoclipping = true; setNoclip(true); notify("Status", "Noclip Active")
    elseif cmd == prefix.."clip" then isNoclipping = false; setNoclip(false); notify("Status", "Noclip Disabled")
    
    -- FREEZE COMMANDS
    elseif cmd == prefix.."freeze" then setFreeze(true)
    elseif cmd == prefix.."unfreeze" then setFreeze(false)

    elseif cmd == prefix.."goto" then
        if args[2] then
            local target = getPlayer(args[2])
            if target and target.Character then LocalPlayer.Character.HumanoidRootPart.CFrame = target.Character.HumanoidRootPart.CFrame * CFrame.new(0, 2, 0) end
        end
    
    elseif cmd == prefix.."join" then
        local targetInput = args[2]
        if targetInput then
            local userId = tonumber(targetInput)
            if not userId then pcall(function() userId = Players:GetUserIdFromNameAsync(targetInput) end) end
            if userId then
                notify("Joining...", "Searching server.")
                local success, err, placeId, instanceId = pcall(function() return TeleportService:GetPlayerPlaceInstanceAsync(userId) end)
      
                if success and placeId and instanceId then TeleportService:TeleportToPlaceInstance(placeId, instanceId, LocalPlayer)
                else notify("Error", "Cannot join player.") end
            end
        end

    elseif cmd == prefix.."follow" then
        if args[2] then local target = getPlayer(args[2]);
            if target then targetPlayer = target; loopJoining = true; notify("Status", "Following "..target.Name) end end
    elseif cmd == prefix.."unfollow" then loopJoining = false;
        targetPlayer = nil; notify("Status", "Stopped Following")

    elseif cmd == prefix.."speed" then
        local val = args[2];
        if val then local char = LocalPlayer.Character; if char and char:FindFirstChild("Humanoid") then 
            if string.lower(val) == "normal" then 
                char.Humanoid.WalkSpeed = 16;
                notify("Speed", "Reset to Normal") 
            else 
                local num = tonumber(val); 
                if num then 
                    char.Humanoid.WalkSpeed = num;
                    notify("Speed", "Set to "..num) 
                end 
            end 
        end end

    elseif cmd == prefix.."fling" then
        if args[2] then local target = getPlayer(args[2]);
            if target then flingTarget = target; isNoclipping = true; setNoclip(true);
            notify("Fling", "Flinging "..target.Name) end end
    elseif cmd == prefix.."unfling" then flingTarget = nil; isNoclipping = false; setNoclip(false);
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then LocalPlayer.Character.HumanoidRootPart.Velocity = Vector3.new(0,0,0); LocalPlayer.Character.HumanoidRootPart.RotVelocity = Vector3.new(0,0,0) end;
        notify("Fling", "Stopped")

    -- Command SuperRing, BlackHole, dan StopControl sudah dihapus dari logika

    elseif cmd == prefix.."doublejump" then isDoubleJump = true; isInfiniteJump = false;
        notify("Status", "Double Jump ON")
    elseif cmd == prefix.."undoublejump" then isDoubleJump = false;
        notify("Status", "Double Jump OFF")
    elseif cmd == prefix.."infjump" then isInfiniteJump = true; isDoubleJump = false;
        notify("Status", "Infinite Jump ON")
    elseif cmd == prefix.."uninfjump" then isInfiniteJump = false;
        notify("Status", "Infinite Jump OFF")
        
    elseif cmd == prefix.."antiidle" or cmd == prefix.."antiafk" then setAntiIdle(true)
    elseif cmd == prefix.."unantiidle" or cmd == prefix.."unantiafk" then setAntiIdle(false)

    -- INVISIBLE COMMANDS
    elseif cmd == prefix.."invisible" or cmd == prefix.."invis" then local char = LocalPlayer.Character;
        if char then for _, part in pairs(char:GetDescendants()) do if part:IsA("BasePart") or part:IsA("Decal") then part.Transparency = 1 end end;
        notify("Invisible", "Ghost Mode Active") end
    elseif cmd == prefix.."visible" or cmd == prefix.."vis" then local char = LocalPlayer.Character;
        if char then for _, part in pairs(char:GetDescendants()) do if part:IsA("BasePart") or part:IsA("Decal") then if part.Name ~= "HumanoidRootPart" then part.Transparency = 0 end end end;
        notify("Visible", "Visible Mode") end

    -- POSE/ANIMATION COMMANDS
    elseif cmd == prefix.."unpose" or cmd == prefix.."stopanim" then 
        stopAllActiveAnimations() 
        
    elseif cmd == prefix.."hop" or cmd == prefix.."serverhop" then notify("Server Hop", "Teleporting...");
        TeleportService:Teleport(game.PlaceId, LocalPlayer) 
    elseif cmd == prefix.."rejoin" then notify("Rejoin", "Rejoining server...");
        TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, LocalPlayer)
    elseif cmd == prefix.."job" or cmd == prefix.."jobid" then local jobId = game.JobId;
        pcall(function() setclipboard(jobId) end); print("Job ID: "..jobId); notify("Job ID", "Copied to clipboard")
    elseif cmd == prefix.."joinjobid" or cmd == prefix.."joindjobid" then local t = args[2];
        if t then notify("Teleporting", "Joining Job ID..."); TeleportService:TeleportToPlaceInstance(game.PlaceId, t, LocalPlayer) else notify("Error", "Usage: !joinjobid [id]") end
        
    elseif cmd == prefix.."spectate" or cmd == prefix.."view" then if args[2] then local target = getPlayer(args[2]);
        if target and target.Character and target.Character:FindFirstChild("Humanoid") then Workspace.CurrentCamera.CameraSubject = target.Character.Humanoid;
            notify("Spectate", "Viewing "..target.Name) end end
    elseif cmd == prefix.."unspectate" or cmd == prefix.."unview" then if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then Workspace.CurrentCamera.CameraSubject = LocalPlayer.Character.Humanoid;
        notify("Spectate", "View Reset") end
    elseif cmd == prefix.."playanim" or cmd == prefix.."anim" then local id = args[2];
        if id then 
            stopAllActiveAnimations() 
            local char = LocalPlayer.Character; local hum = char and char:FindFirstChild("Humanoid");
            if hum then local animator = hum:FindFirstChildOfClass("Animator") or hum; local anim = Instance.new("Animation"); anim.AnimationId = "rbxassetid://"..id; local track = animator:LoadAnimation(anim);
                track:Play(); table.insert(activeAnimTracks, track); notify("Animation", "Playing ID: "..id) end end
    
    -- KAMUI
    elseif cmd == prefix.."kamui" then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            lastPos = char.HumanoidRootPart.CFrame
            if kamuiFolder then kamuiFolder:Destroy() end
            kamuiFolder = Instance.new("Folder");
            kamuiFolder.Name = "KamuiDimension"; kamuiFolder.Parent = Workspace
            local centerPos = Vector3.new(500000, 5000, 500000)

            -- 1. Void Box
            local function createWall(size, pos) local wall = Instance.new("Part");
                wall.Anchored = true; wall.CanCollide = true; wall.Size = size; wall.Position = pos; wall.Material = Enum.Material.Plastic; wall.Color = Color3.fromRGB(0, 0, 0);
                wall.Parent = kamuiFolder end
            createWall(Vector3.new(roomSize, wallThickness, roomSize), centerPos + Vector3.new(0, -50, 0));
            createWall(Vector3.new(roomSize, wallThickness, roomSize), centerPos + Vector3.new(0, roomSize/2, 0))
            createWall(Vector3.new(wallThickness, roomSize, roomSize), centerPos + Vector3.new(roomSize/2, roomSize/4, 0));
            createWall(Vector3.new(wallThickness, roomSize, roomSize), centerPos + Vector3.new(-roomSize/2, roomSize/4, 0))
            createWall(Vector3.new(roomSize, roomSize, wallThickness), centerPos + Vector3.new(0, roomSize/4, roomSize/2));
            createWall(Vector3.new(roomSize, roomSize, wallThickness), centerPos + Vector3.new(0, roomSize/4, -roomSize/2))

            -- 2. Floors
            local mainFloor = Instance.new("Part");
            mainFloor.Name = "MainFloor"; mainFloor.Size = Vector3.new(roomSize - 20, 1, roomSize - 20); mainFloor.Position = centerPos; mainFloor.Anchored = true;
            mainFloor.Material = Enum.Material.Concrete; mainFloor.Color = Color3.fromRGB(20, 20, 20); mainFloor.Parent = kamuiFolder
            local arenaFloor = Instance.new("Part");
            arenaFloor.Name = "ArenaFloor"; arenaFloor.Size = Vector3.new(arenaSize, 1.2, arenaSize); arenaFloor.Position = centerPos; arenaFloor.Anchored = true; arenaFloor.Material = Enum.Material.Concrete;
            arenaFloor.Color = Color3.fromRGB(40, 40, 40); arenaFloor.Parent = kamuiFolder

            -- 3. Neon Borders (Merah)
            local function createBorder(size, pos) local p = Instance.new("Part");
                p.Size=size; p.Position=pos; p.Anchored=true; p.CanCollide=false; p.Material=Enum.Material.Neon; p.Color=Color3.fromRGB(150, 0, 0); p.Parent=kamuiFolder end
            local bThick = 1;
            local half = arenaSize/2
            createBorder(Vector3.new(arenaSize, 0.5, bThick), centerPos + Vector3.new(0, 0.7, half))
            createBorder(Vector3.new(arenaSize, 0.5, bThick), centerPos + Vector3.new(0, 0.7, -half))
            createBorder(Vector3.new(bThick, 0.5, arenaSize), centerPos + Vector3.new(half, 0.7, 0))
            createBorder(Vector3.new(bThick, 0.5, arenaSize), centerPos + Vector3.new(-half, 0.7, 0))

            -- 4. Pillars (City)
            local gridSize = 50;
            local areaSize = (roomSize / 2) - 50
            for x = -areaSize, areaSize, gridSize do for z = -areaSize, areaSize, gridSize do if math.abs(x) > (half + 10) or math.abs(z) > (half + 10) then if math.random(1, 10) > 3 then local block = Instance.new("Part");
                block.Anchored = true; block.CanCollide = true; block.Material = Enum.Material.Concrete; local shade = math.random(30, 80); block.Color = Color3.fromRGB(shade, shade, shade);
                local h = math.random(30, 150); local w = math.random(10, 30); block.Size = Vector3.new(w, h, w);
                block.Position = centerPos + Vector3.new(x + math.random(-5,5), h/2, z + math.random(-5,5));
                block.Parent = kamuiFolder end end end end
            
            -- 5. Particles (Void Ash)
            local particlePart = Instance.new("Part");
            particlePart.Size = Vector3.new(roomSize, 1, roomSize); particlePart.Position = centerPos + Vector3.new(0, -2, 0); particlePart.Anchored = true; particlePart.Transparency = 1;
            particlePart.CanCollide = false; particlePart.Parent = kamuiFolder
            local emitter = Instance.new("ParticleEmitter");
            emitter.Texture = "rbxassetid://243098098"; emitter.Rate = 50; emitter.Lifetime = NumberRange.new(5, 10); emitter.Speed = NumberRange.new(2, 5); emitter.Color = ColorSequence.new(Color3.fromRGB(50,50,50));
            emitter.Parent = particlePart

            char.HumanoidRootPart.CFrame = CFrame.new(centerPos + Vector3.new(0, 5, 0))
            notify("Kamui", "Arena Generated (No Throne).")
        end

    elseif cmd == prefix.."unkamui" then
        local char = LocalPlayer.Character
        if char then if lastPos then char.HumanoidRootPart.CFrame = lastPos else char.Humanoid.Health = 0 end;
            if kamuiFolder then kamuiFolder:Destroy(); kamuiFolder = nil end; notify("Kamui", "Returned.") end
    end
end)

notify("EXX HUB", "Type '!' or '!cmds' to open menu.")
