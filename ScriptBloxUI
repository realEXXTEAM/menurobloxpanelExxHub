--- BETA TESTING ---
-- By RealExxTeam --

local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")

-- 1. Check Executor
local requestFunc = request or http_request or (syn and syn.request)
local setclipboardFunc = setclipboard or toclipboard or set_clipboard

if not requestFunc then
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Warning";
        Text = "Executor not support request()!";
    })
    return
end

-- 2. UI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "Script BloxUI"
ScreenGui.DisplayOrder = 9999
ScreenGui.ResetOnSpawn = false
ScreenGui.IgnoreGuiInset = true
ScreenGui.Enabled = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- === PARENTING (PlayerGui ONLY) ===
if Players.LocalPlayer then
    ScreenGui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
else
    warn("LocalPlayer Not Found")
    return
end

-- Theme Colors
local Colors = {
    Bg = Color3.fromRGB(18, 18, 22),         
    Header = Color3.fromRGB(25, 25, 30),     
    Card = Color3.fromRGB(32, 32, 38),       
    Accent = Color3.fromRGB(0, 140, 255),    
    Text = Color3.fromRGB(245, 245, 245),    
    SubText = Color3.fromRGB(160, 160, 160), 
}

-- === MAIN FRAME (COMPACT SIZE 400x260) ===
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainUI"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Colors.Bg
MainFrame.BorderSizePixel = 0
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.Size = UDim2.new(0, 400, 0, 260) 
MainFrame.ClipsDescendants = true
MainFrame.Active = true
MainFrame.Draggable = false -- NO DRAG

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 8)
MainCorner.Parent = MainFrame

-- === 1. HEADBAR ===
local HeaderBar = Instance.new("Frame")
HeaderBar.Name = "Header"
HeaderBar.Parent = MainFrame
HeaderBar.BackgroundColor3 = Colors.Header
HeaderBar.Size = UDim2.new(1, 0, 0, 30)
HeaderBar.BorderSizePixel = 0
HeaderBar.ZIndex = 2

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 8)
HeaderCorner.Parent = HeaderBar

local HeaderFill = Instance.new("Frame")
HeaderFill.Parent = HeaderBar
HeaderFill.BackgroundColor3 = Colors.Header
HeaderFill.BorderSizePixel = 0
HeaderFill.Size = UDim2.new(1, 0, 0, 5)
HeaderFill.Position = UDim2.new(0, 0, 1, -5)
HeaderFill.ZIndex = 2

-- Title Text
local TitleLabel = Instance.new("TextLabel")
TitleLabel.Parent = HeaderBar
TitleLabel.BackgroundTransparency = 1
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.Size = UDim2.new(1, -40, 1, 0)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.Text = "Search Script In ScriptBlox"
TitleLabel.TextColor3 = Colors.Text
TitleLabel.TextSize = 12
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.ZIndex = 3

-- Close Button "X"
local CloseUIBtn = Instance.new("TextButton")
CloseUIBtn.Parent = HeaderBar
CloseUIBtn.BackgroundTransparency = 1
CloseUIBtn.Position = UDim2.new(1, -30, 0, 0)
CloseUIBtn.Size = UDim2.new(0, 30, 1, 0)
CloseUIBtn.Font = Enum.Font.GothamBold
CloseUIBtn.Text = "X"
CloseUIBtn.TextColor3 = Colors.SubText
CloseUIBtn.TextSize = 14
CloseUIBtn.ZIndex = 3

CloseUIBtn.MouseEnter:Connect(function()
    TweenService:Create(CloseUIBtn, TweenInfo.new(0.2), {TextColor3 = Color3.fromRGB(255, 255, 255)}):Play()
end)
CloseUIBtn.MouseLeave:Connect(function()
    TweenService:Create(CloseUIBtn, TweenInfo.new(0.2), {TextColor3 = Colors.SubText}):Play()
end)

-- === 2. SEARCH BAR AREA ===
local SearchContainer = Instance.new("Frame")
SearchContainer.Parent = MainFrame
SearchContainer.BackgroundColor3 = Colors.Card
SearchContainer.Position = UDim2.new(0, 10, 0, 38)
SearchContainer.Size = UDim2.new(1, -20, 0, 32)
local SearchCorner = Instance.new("UICorner")
SearchCorner.CornerRadius = UDim.new(0, 6)
SearchCorner.Parent = SearchContainer

local SearchIcon = Instance.new("ImageLabel")
SearchIcon.Parent = SearchContainer
SearchIcon.BackgroundTransparency = 1
SearchIcon.Position = UDim2.new(0, 8, 0.5, -7)
SearchIcon.Size = UDim2.new(0, 14, 0, 14)
SearchIcon.Image = "rbxassetid://3926305904"
SearchIcon.ImageRectOffset = Vector2.new(964, 324)
SearchIcon.ImageRectSize = Vector2.new(36, 36)
SearchIcon.ImageColor3 = Colors.SubText

local InputBox = Instance.new("TextBox")
InputBox.Parent = SearchContainer
InputBox.BackgroundTransparency = 1
InputBox.Position = UDim2.new(0, 30, 0, 0)
InputBox.Size = UDim2.new(1, -35, 1, 0)
InputBox.Font = Enum.Font.GothamMedium
InputBox.Text = ""
InputBox.PlaceholderText = "Type script name..."
InputBox.TextColor3 = Colors.Text
InputBox.PlaceholderColor3 = Colors.SubText
InputBox.TextSize = 12
InputBox.TextXAlignment = Enum.TextXAlignment.Left

-- === 3. RESULTS SCROLL ===
local ResultsScroll = Instance.new("ScrollingFrame")
ResultsScroll.Parent = MainFrame
ResultsScroll.BackgroundTransparency = 1
ResultsScroll.Position = UDim2.new(0, 10, 0, 80)
ResultsScroll.Size = UDim2.new(1, -10, 1, -85)
ResultsScroll.ScrollBarThickness = 2
ResultsScroll.ScrollBarImageColor3 = Colors.Accent
ResultsScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
ResultsScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
ResultsScroll.Visible = false

local Grid = Instance.new("UIGridLayout")
Grid.Parent = ResultsScroll
Grid.CellPadding = UDim2.new(0, 6, 0, 6)
Grid.CellSize = UDim2.new(0, 120, 0, 75)
Grid.FillDirectionMaxCells = 3

-- Placeholder Text
local Placeholder = Instance.new("TextLabel")
Placeholder.Parent = MainFrame
Placeholder.BackgroundTransparency = 1
Placeholder.Position = UDim2.new(0, 0, 0, 80)
Placeholder.Size = UDim2.new(1, 0, 1, -80)
Placeholder.Font = Enum.Font.GothamBold
Placeholder.Text = "Search for text input script in the search box"
Placeholder.TextColor3 = Colors.SubText
Placeholder.TextSize = 14
Placeholder.TextWrapped = true

-- === MODAL NOTIFICATION ===
local ModalOverlay = Instance.new("Frame")
ModalOverlay.Name = "ModalOverlay"
ModalOverlay.Parent = ScreenGui
ModalOverlay.BackgroundColor3 = Color3.new(0,0,0)
ModalOverlay.BackgroundTransparency = 0.5
ModalOverlay.Size = UDim2.new(1, 0, 1, 0)
ModalOverlay.ZIndex = 50
ModalOverlay.Visible = false

local ModalBox = Instance.new("Frame")
ModalBox.Parent = ModalOverlay
ModalBox.BackgroundColor3 = Colors.Card
ModalBox.AnchorPoint = Vector2.new(0.5, 0.5)
ModalBox.Position = UDim2.new(0.5, 0, 0.5, 0)
ModalBox.Size = UDim2.new(0, 240, 0, 150)
ModalBox.ZIndex = 51
Instance.new("UICorner", ModalBox).CornerRadius = UDim.new(0, 8)

local MTitle = Instance.new("TextLabel")
MTitle.Parent = ModalBox
MTitle.BackgroundTransparency = 1
MTitle.Position = UDim2.new(0, 10, 0, 8)
MTitle.Size = UDim2.new(1, -30, 0, 20)
MTitle.Font = Enum.Font.GothamBold
MTitle.Text = "Script Title"
MTitle.TextColor3 = Colors.Text
MTitle.TextSize = 12
MTitle.TextXAlignment = Enum.TextXAlignment.Left
MTitle.TextTruncate = Enum.TextTruncate.AtEnd
MTitle.ZIndex = 52

local MClose = Instance.new("TextButton")
MClose.Parent = ModalBox
MClose.BackgroundTransparency = 1
MClose.Position = UDim2.new(1, -25, 0, 5)
MClose.Size = UDim2.new(0, 20, 0, 20)
MClose.Text = "X"
MClose.Font = Enum.Font.GothamBold
MClose.TextColor3 = Colors.SubText
MClose.TextSize = 14
MClose.ZIndex = 52

local MDesc = Instance.new("TextLabel")
MDesc.Parent = ModalBox
MDesc.BackgroundTransparency = 1
MDesc.Position = UDim2.new(0, 10, 0, 30)
MDesc.Size = UDim2.new(1, -20, 0, 70)
MDesc.Font = Enum.Font.Gotham
MDesc.Text = "Loading..."
MDesc.TextColor3 = Colors.SubText
MDesc.TextSize = 10
MDesc.TextWrapped = true
MDesc.TextYAlignment = Enum.TextYAlignment.Top
MDesc.ZIndex = 52

local BtnRun = Instance.new("TextButton")
BtnRun.Parent = ModalBox
BtnRun.BackgroundColor3 = Color3.fromRGB(0, 180, 100)
BtnRun.Position = UDim2.new(0, 10, 1, -35)
BtnRun.Size = UDim2.new(0.5, -15, 0, 25)
BtnRun.Font = Enum.Font.GothamBold
BtnRun.Text = "RUN"
BtnRun.TextColor3 = Color3.new(1,1,1)
BtnRun.TextSize = 10
BtnRun.ZIndex = 52
Instance.new("UICorner", BtnRun).CornerRadius = UDim.new(0,4)

local BtnCopy = Instance.new("TextButton")
BtnCopy.Parent = ModalBox
BtnCopy.BackgroundColor3 = Colors.Accent
BtnCopy.Position = UDim2.new(0.5, 5, 1, -35)
BtnCopy.Size = UDim2.new(0.5, -15, 0, 25)
BtnCopy.Font = Enum.Font.GothamBold
BtnCopy.Text = "COPY"
BtnCopy.TextColor3 = Color3.new(1,1,1)
BtnCopy.TextSize = 10
BtnCopy.ZIndex = 52
Instance.new("UICorner", BtnCopy).CornerRadius = UDim.new(0,4)

-- === LOGIC ===
local currentScript = ""
local isGuiVisible = true

local function CreateCard(data)
    local btn = Instance.new("TextButton")
    btn.Parent = ResultsScroll
    btn.BackgroundColor3 = Colors.Card
    btn.Text = ""
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
    
    local title = Instance.new("TextLabel")
    title.Parent = btn
    title.BackgroundTransparency = 1
    title.Position = UDim2.new(0, 6, 0, 20)
    title.Size = UDim2.new(1, -12, 0, 30)
    title.Font = Enum.Font.GothamBold
    title.Text = data.title
    title.TextColor3 = Colors.Text
    title.TextSize = 10
    title.TextWrapped = true
    title.TextYAlignment = Enum.TextYAlignment.Top
    title.TextXAlignment = Enum.TextXAlignment.Left
    
    local typeTag = Instance.new("TextLabel")
    typeTag.Parent = btn
    typeTag.BackgroundTransparency = 1
    typeTag.Position = UDim2.new(0, 6, 0, 4)
    typeTag.Size = UDim2.new(1, -12, 0, 12)
    typeTag.Font = Enum.Font.GothamBold
    typeTag.Text = (data.game and data.game.name) or "Universal"
    typeTag.TextColor3 = Colors.Accent
    typeTag.TextSize = 8
    typeTag.TextXAlignment = Enum.TextXAlignment.Left
    
    local views = Instance.new("TextLabel")
    views.Parent = btn
    views.BackgroundTransparency = 1
    views.Position = UDim2.new(0, 6, 1, -16)
    views.Size = UDim2.new(1, -12, 0, 12)
    views.Font = Enum.Font.Gotham
    views.Text = "üëÅ "..(data.views or 0)
    views.TextColor3 = Colors.SubText
    views.TextSize = 9
    views.TextXAlignment = Enum.TextXAlignment.Left

    btn.MouseButton1Click:Connect(function()
        MTitle.Text = data.title
        MDesc.Text = "Game: " .. ((data.game and data.game.name) or "Universal") .. "\nViews: " .. (data.views or 0)
        currentScript = data.script or ""
        ModalOverlay.Visible = true
    end)
end

local function Search(txt)
    for _,v in pairs(ResultsScroll:GetChildren()) do
        if v:IsA("TextButton") then v:Destroy() end
    end
    
    if txt == "" then
        Placeholder.Visible = true
        ResultsScroll.Visible = false
        return
    end
    
    Placeholder.Visible = false
    ResultsScroll.Visible = true
    
    spawn(function()
        local encoded = HttpService:UrlEncode(txt)
        local url = "https://scriptblox.com/api/script/search?q="..encoded.."&mode=free&page=1"
        local s, r = pcall(function() return requestFunc({Url=url, Method="GET"}) end)
        if s and r.StatusCode == 200 then
            local d = HttpService:JSONDecode(r.Body)
            if d.result and d.result.scripts then
                for _, sc in pairs(d.result.scripts) do
                    CreateCard(sc)
                end
                ResultsScroll.CanvasPosition = Vector2.new(0,0)
            end
        end
    end)
end

InputBox.FocusLost:Connect(function(enter)
    if enter then Search(InputBox.Text) end
end)

CloseUIBtn.MouseButton1Click:Connect(function()
    isGuiVisible = false
    ScreenGui.Enabled = false
end)

MClose.MouseButton1Click:Connect(function()
    ModalOverlay.Visible = false
end)

BtnCopy.MouseButton1Click:Connect(function()
    if currentScript ~= "" then
        setclipboardFunc(currentScript)
        BtnCopy.Text = "COPIED!"
        wait(1)
        BtnCopy.Text = "COPY"
    end
end)

-- LOGIC BARU: Run & Auto Close
BtnRun.MouseButton1Click:Connect(function()
    if currentScript ~= "" then
        -- Execute
        loadstring(currentScript)()
        
        -- Visual Feedback
        BtnRun.Text = "EXECUTED!"
        wait(0.5) -- Jeda sebentar biar user liat statusnya
        
        -- Auto Close Modal
        ModalOverlay.Visible = false
        BtnRun.Text = "RUN" -- Reset
    end
end)

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.RightControl then
        isGuiVisible = not isGuiVisible
        ScreenGui.Enabled = isGuiVisible
    end
end)
