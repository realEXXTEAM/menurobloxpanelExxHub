local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local Player = game.Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

--// CONFIGURASI ICON
local MENU_ICON_ID = "rbxassetid://84755900656538" 
local CLOSE_ICON_ID = "rbxassetid://121392148105762" 

--// GUI Setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "TopBarMenuExxHub"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
screenGui.DisplayOrder = 1000000
screenGui.IgnoreGuiInset = true

--// Parenting CoreGui
local success, err = pcall(function()
    screenGui.Parent = CoreGui
end)
if not success then
    screenGui.Parent = PlayerGui
end

--// Background Click Detector (Auto Close)
local closeDetector = Instance.new("TextButton")
closeDetector.Name = "CloseDetector"
closeDetector.Size = UDim2.new(1, 0, 1, 0)
closeDetector.BackgroundTransparency = 1
closeDetector.Text = ""
closeDetector.AutoButtonColor = false
closeDetector.Visible = false 
closeDetector.ZIndex = 9990 
closeDetector.Parent = screenGui

--// Toggle Button
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 44, 0, 44)
toggleButton.Position = UDim2.new(0.5, -22, 0, 12)
toggleButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
toggleButton.BackgroundTransparency = 0.2
toggleButton.Text = ""
toggleButton.ZIndex = 9999
toggleButton.Parent = screenGui

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(1, 0)
toggleCorner.Parent = toggleButton

--// [UPDATE] Icon dengan ukuran besar
local mainIcon = Instance.new("ImageLabel")
mainIcon.Name = "MainIcon"
mainIcon.Size = UDim2.new(0.85, 0, 0.85, 0) 
mainIcon.AnchorPoint = Vector2.new(0.5, 0.5)
mainIcon.Position = UDim2.new(0.5, 0, 0.5, 0)
mainIcon.BackgroundTransparency = 1
mainIcon.Image = MENU_ICON_ID 
mainIcon.ScaleType = Enum.ScaleType.Fit
mainIcon.ZIndex = 9999
mainIcon.Parent = toggleButton

--// Popup Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 0, 0, 0) 
mainFrame.Position = UDim2.new(0.5, 0, 0, 65)
mainFrame.AnchorPoint = Vector2.new(0.5, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
mainFrame.BackgroundTransparency = 0.1
mainFrame.Visible = false
mainFrame.ClipsDescendants = true
mainFrame.ZIndex = 9998
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 10)
mainCorner.Parent = mainFrame

--// Scrolling Menu
local scroll = Instance.new("ScrollingFrame")
scroll.Size = UDim2.new(1, -10, 1, -10)
scroll.Position = UDim2.new(0, 5, 0, 5)
scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
scroll.ScrollingDirection = Enum.ScrollingDirection.X 
scroll.ScrollBarThickness = 2
scroll.BackgroundTransparency = 1
scroll.ZIndex = 9998
scroll.Parent = mainFrame

local listLayout = Instance.new("UIListLayout")
listLayout.Parent = scroll
listLayout.FillDirection = Enum.FillDirection.Horizontal
listLayout.Padding = UDim.new(0, 10)
listLayout.VerticalAlignment = Enum.VerticalAlignment.Center

--// Menu Items
local menuItems = {
    {Text="Executor", Icon="rbxassetid://6031075938"},
    {Text="Script Blox", Icon="rbxassetid://91251007612635"},
    {Text="Script", Icon="rbxassetid://112780490255100"},
    {Text="Save Script", Icon="rbxassetid://112238336567509"},
	 {Text="Music", Icon="rbxassetid://95034182657328"},
    {Text="Goto Players", Icon="rbxassetid://80278360213440"},
    {Text="AnimChanger", Icon="rbxassetid://115198205982652"},
    {Text="Info Server", Icon="rbxassetid://119828878228867"},
    {Text="ESP Players", Icon="rbxassetid://6031075931"},
}

local opened = false
local animating = false

--// [UPDATE] Animasi Menyusut + Berputar + Ganti Icon
local function toggleMenu(state)
    if animating then return end
    animating = true
    opened = state

    closeDetector.Visible = opened

    -- 1. Animasi Menyusut Sambil Berputar 180 derajat
    local shrinkInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
    local shrinkTween = TweenService:Create(mainIcon, shrinkInfo, {
        Size = UDim2.new(0, 0, 0, 0),
        Rotation = 180
    })
    
    shrinkTween:Play()
    shrinkTween.Completed:Wait()

    -- Ganti Icon Gambar & Reset Rotasi ke arah sebaliknya untuk efek putaran halus kembali
    if opened then
        mainIcon.Image = CLOSE_ICON_ID
        mainIcon.Rotation = -180
        
        mainFrame.Visible = true
        task.spawn(function()
            local tween1 = TweenService:Create(mainFrame, TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(0, 50, 0, 50)})
            tween1:Play()
            tween1.Completed:Wait()
            TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Size = UDim2.new(0, 300, 0, 60)}):Play()
        end)
    else
        mainIcon.Image = MENU_ICON_ID
        mainIcon.Rotation = -180
        
        task.spawn(function()
            local tweenClose = TweenService:Create(mainFrame, TweenInfo.new(0.2, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {Size = UDim2.new(0, 0, 0, 0)})
            tweenClose:Play()
            tweenClose.Completed:Wait()
            mainFrame.Visible = false
        end)
    end

    -- 2. Animasi Membesar (Grow) + Berputar Balik ke 0 + Efek Back (Memantul)
    local growInfo = TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    local growTween = TweenService:Create(mainIcon, growInfo, {
        Size = UDim2.new(0.85, 0, 0.85, 0),
        Rotation = 0
    })
    
    growTween:Play()
    task.wait(0.3)
    animating = false
end

-- Klik tombol utama
toggleButton.MouseButton1Click:Connect(function()
    toggleMenu(not opened)
end)

-- Klik di luar frame (Auto Close)
closeDetector.MouseButton1Click:Connect(function()
    if opened then
        toggleMenu(false)
    end
end)

-- Validasi UI (untuk fitur auto-disable UI lain)
local validUINames = {}
for _, item in ipairs(menuItems) do
    validUINames[item.Text.."UI"] = true
end

-- Tombol Menu
for i, item in ipairs(menuItems) do
    local btn = Instance.new("ImageButton")
    btn.Size = UDim2.new(0, 45, 0, 45)
    btn.BackgroundColor3 = Color3.fromRGB(35,35,35)
    btn.BackgroundTransparency = 0.7
    btn.Image = item.Icon
    btn.ScaleType = Enum.ScaleType.Fit
    btn.ZIndex = 9998
    btn.Parent = scroll
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0,8)
    corner.Parent = btn

    btn.MouseButton1Click:Connect(function()
        local uiName = item.Text.."UI"
        local targetUI = PlayerGui:FindFirstChild(uiName) or CoreGui:FindFirstChild(uiName)

        local function disableOthers(folder)
            for _, v in pairs(folder:GetChildren()) do
                if v:IsA("ScreenGui") and validUINames[v.Name] and v.Name ~= uiName then
                    v.Enabled = false
                end
            end
        end

        disableOthers(PlayerGui)
        disableOthers(CoreGui)

        if targetUI then 
            targetUI.Enabled = not targetUI.Enabled 
        end
        
        toggleMenu(false)
    end)
end

scroll.CanvasSize = UDim2.new(0, (#menuItems * 55), 0, 0)
