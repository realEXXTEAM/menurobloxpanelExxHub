local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local TweenService = game:GetService("TweenService")

--// ScreenGui Setup
local ScriptUI = Instance.new("ScreenGui")
ScriptUI.Name = "ScriptUI"
ScriptUI.ResetOnSpawn = false
ScriptUI.ZIndexBehavior = Enum.ZIndexBehavior.Global
ScriptUI.IgnoreGuiInset = false
ScriptUI.Enabled = false
ScriptUI.Parent = Player:WaitForChild("PlayerGui")

--// Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 520, 0, 320)
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.Parent = ScriptUI
mainFrame.ClipsDescendants = true
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 10)

--// Close Button
local closeBtn = Instance.new("TextButton")
closeBtn.Text = "X"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextScaled = true
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.BackgroundTransparency = 1
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -35, 0, 5)
closeBtn.ZIndex = 5
closeBtn.Parent = mainFrame

closeBtn.MouseButton1Click:Connect(function()
	ScriptUI.Enabled = false
end)

--// Refresh Button
local refreshBtn = Instance.new("TextButton")
refreshBtn.Text = "ðŸ”„"
refreshBtn.Font = Enum.Font.GothamBold
refreshBtn.TextScaled = true
refreshBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
refreshBtn.BackgroundTransparency = 1
refreshBtn.Size = UDim2.new(0, 30, 0, 30)
refreshBtn.Position = UDim2.new(1, -70, 0, 5)
refreshBtn.ZIndex = 5
refreshBtn.Parent = mainFrame

refreshBtn.MouseButton1Click:Connect(function()
    if Player.PlayerGui:FindFirstChild("ScriptUI") then
        Player.PlayerGui.ScriptUI:Destroy()
    end
    loadstring(game:HttpGet("https://raw.githubusercontent.com/realEXXTEAM/menurobloxpanelExxHub/refs/heads/main/ScriptUI"))()
end)


--// Search Button (Small, initial)
local searchButton = Instance.new("TextButton")
searchButton.Text = "Search"
searchButton.Font = Enum.Font.GothamBold
searchButton.TextSize = 16
searchButton.TextColor3 = Color3.fromRGB(255, 255, 255)
searchButton.Size = UDim2.new(0, 90, 0, 32)
searchButton.Position = UDim2.new(0.5, 0, 0, 15)
searchButton.AnchorPoint = Vector2.new(0.5, 0)
searchButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
searchButton.BorderSizePixel = 0
searchButton.Parent = mainFrame
Instance.new("UICorner", searchButton).CornerRadius = UDim.new(0, 8)

--// Search Box (Hidden initially)
local searchBox = Instance.new("TextBox")
searchBox.PlaceholderText = "Cari Script..."
searchBox.Text = ""
searchBox.Font = Enum.Font.Gotham
searchBox.TextSize = 16
searchBox.TextColor3 = Color3.fromRGB(255, 255, 255)
searchBox.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
searchBox.BorderSizePixel = 0
searchBox.Visible = false
searchBox.Size = UDim2.new(0, 220, 0, 32)
searchBox.Position = searchButton.Position
searchBox.AnchorPoint = Vector2.new(0.5, 0)
searchBox.Parent = mainFrame
Instance.new("UICorner", searchBox).CornerRadius = UDim.new(0, 8)

--// Clear (X) inside searchBox
local clearX = Instance.new("TextButton")
clearX.Text = "X"
clearX.Font = Enum.Font.GothamBold
clearX.TextSize = 14
clearX.TextColor3 = Color3.fromRGB(255,255,255)
clearX.BackgroundTransparency = 1
clearX.Size = UDim2.new(0, 20, 0, 20)
clearX.Position = UDim2.new(1, -24, 0, 6)
clearX.Visible = false
clearX.Parent = searchBox

--// Search Open Animation
local function openSearch()
	searchButton.Visible = false
	searchBox.Visible = true

	TweenService:Create(
		searchBox,
		TweenInfo.new(0.25, Enum.EasingStyle.Sine, Enum.EasingDirection.Out),
		{Size = UDim2.new(0, 250, 0, 32), Position = UDim2.new(0.5, 0, 0, 15)}
	):Play()

	searchBox:CaptureFocus()
end

--// Search Close Animation (collapse to button)
local function closeSearch()
	searchBox:ReleaseFocus()

	TweenService:Create(
		searchBox,
		TweenInfo.new(0.25, Enum.EasingStyle.Sine, Enum.EasingDirection.Out),
		{Size = UDim2.new(0, 90, 0, 32), Position = UDim2.new(0.5, 0, 0, 15)}
	):Play()

	task.wait(0.25)
	searchBox.Visible = false
	searchBox.Text = ""
	clearX.Visible = false
	searchButton.Visible = true
end

searchButton.MouseButton1Click:Connect(openSearch)

-- whenever focus lost and not enter pressed -> collapse
searchBox.FocusLost:Connect(function(enterPressed)
	if not enterPressed then
		-- if text empty -> collapse; else keep box shown
		if searchBox.Text == "" then
			closeSearch()
		end
	end
end)

-- clear button behavior
clearX.MouseButton1Click:Connect(function()
	searchBox.Text = ""
	clearX.Visible = false
	-- collapse back to button since text cleared
	closeSearch()
end)

-- show/hide clearX and collapse when text cleared by typing
searchBox:GetPropertyChangedSignal("Text"):Connect(function()
	if searchBox.Text ~= "" then
		clearX.Visible = true
	else
		clearX.Visible = false
		-- if user deleted all text and the box is focused, collapse back
		-- (we wait a frame to avoid immediate flicker on focus events)
		task.defer(function()
			if searchBox.Text == "" and searchBox.Visible then
				closeSearch()
			end
		end)
	end

	-- filter list in realtime
	local query = string.lower(searchBox.Text)
	for _, child in ipairs(listFrame:GetChildren()) do
		if child:IsA("Frame") then
			local lbl = child:FindFirstChildOfClass("TextLabel")
			if lbl then
				child.Visible = (query == "" or string.find(string.lower(lbl.Text), query) ~= nil)
			end
		end
	end
end)

--// Scrolling List
local listFrame = Instance.new("ScrollingFrame")
listFrame.Size = UDim2.new(1, -20, 1, -70)
listFrame.Position = UDim2.new(0, 10, 0, 60)
listFrame.BackgroundTransparency = 1
listFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
listFrame.ScrollBarThickness = 6
listFrame.ScrollingDirection = Enum.ScrollingDirection.Y
listFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
listFrame.Parent = mainFrame

local uiGrid = Instance.new("UIGridLayout")
uiGrid.CellSize = UDim2.new(0, 155, 0, 140)
uiGrid.CellPadding = UDim2.new(0, 10, 0, 10)
uiGrid.FillDirectionMaxCells = 3
uiGrid.FillDirection = Enum.FillDirection.Horizontal
uiGrid.SortOrder = Enum.SortOrder.LayoutOrder
uiGrid.HorizontalAlignment = Enum.HorizontalAlignment.Center
uiGrid.Parent = listFrame

Instance.new("UIPadding", listFrame).PaddingLeft = UDim.new(0, 5)

--// Example Data (kept as-is)
local scripts = {
    {title = "", image = "rbxassetid://0", text = ""},
    {title = "Ls Zee Hub - Hunty Zombie (Keyless)", image = "rbxassetid://76094756361741", text = "loadstring(game:HttpGet('https://zuwz.me/Ls-Zee-Hub-HZ'))()"},
    {title = "Prison Berry Escape (Free Tools All, Kill All)", image = "rbxassetid://0", text = "loadstring(game:HttpGet('https://raw.githubusercontent.com/VylikGylik/Script/refs/heads/main/Barry%20Prison%20Escape'))()"},
    {title = "Auto Bounty KiddoHiru - Blox Fruit's Script (Setting Open Your Browser)(NO KEY)", image = "rbxassetid://124015766651987", text = "loadstring(game:HttpGet('https://pastebin.com/raw/keGmE2QK))()"},
    {title = "Sol Hub - Blox Fruit's Script (No Keyles)", image = "rbxassetid://124015766651987", text = "loadstring(game:HttpGet('https://raw.githubusercontent.com/GoblinKun009/Script/refs/heads/main/SolHub', true))()"},
    {title = "Vinz Hub - Fish It (Fast Auto Fish, Jungle Explosion Update, Teleport Anywhere) (NO KEY)", image = "rbxassetid://125872787106802", text = "loadstring(game:HttpGet('https://raw.githubusercontent.com/Vinzyy13/VinzHub/refs/heads/main/Fish-It'))()"},
    {title = "The Sus Script ðŸ¤“", image = "rbxassetid://102002093572733", text = "loadstring(game:HttpGet('https://pastefy.app/aVWy3E4k/raw'))()"},
    {title = "Stree Hub - Fish It (Instant Fish, Bloodmoon)(NO KEY)", image = "rbxassetid://125872787106802", text = "loadstring(game:HttpGet('https://pandadevelopment.net/virtual/file/ecd9069dab3d2aa3'))()"},
    {title = "Vora Hub - Fish It (Instant Fish, Bloodmoon)(NO KEY)", image = "rbxassetid://125872787106802", text = "loadstring(game:HttpGet('https://pandadevelopment.net/virtual/file/b5652e722eb30b13'))()"},
    {title = "Mirage Hub - Hunty Zombies (KEY 9tccBECyzJ)", image = "rbxassetid://76094756361741", text = "loadstring(game:HttpGet('https://pastefy.app/ULaWpxKm/raw'))()"},
    {title = "Copy Avatar FE", image = "rbxassetid://102002093572733", text = "loadstring(game:HttpGet('https://raw.githubusercontent.com/GhostPlayer352/Test4/refs/heads/main/Copy%20Avatar'))()"},
    {title = "OK HUB â€“ Blox Fruits Script (NO KEY)", image = "rbxassetid://124015766651987", text = "loadstring(game:HttpGet('https://raw.githubusercontent.com/fakekuri/Okhubhere/refs/heads/main/MainBloxFruit.lua'))()"},
    {title = "Gravity Hub â€“ Blox Fruits Script (NO KEY)", image = "rbxassetid://124015766651987", text = "loadstring(game:HttpGet('https://raw.githubusercontent.com/Dev-GravityHub/BloxFruit/refs/heads/main/Main.lua'))()"},
	{title = "Teddy Hub - Blox Fruit's Script (NO KEY)", image = "rbxassetid://124015766651987", text = "loadstring(game:HttpGet('https://pastefy.app/FnTSKXtt/raw'))()"},
	{title = "Quantum Hub - Blox Fruit's Script (NO KEY)", image = "rbxassetid://124015766651987", text = "loadstring(game:HttpGet('https://raw.githubusercontent.com/flazhy/QuantumOnyx/refs/heads/main/QuantumOnyx.lua'))()"},
	{title = "Ego Hub - Blox Fruit's Script (NO KEY)", image = "rbxassetid://124015766651987", text = "loadstring(game:HttpGet('https://pastefy.app/gU8wlEbc/raw'))()"},
}


--// Card Creator (kept list intact)
local function createScriptCard(data)
	local card = Instance.new("Frame")
	card.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	card.BackgroundTransparency = 0.2
	card.Size = UDim2.new(0, 155, 0, 140)
	card.Parent = listFrame

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 8)
	corner.Parent = card

	local img = Instance.new("ImageLabel")
	img.Image = data.image
	img.Size = UDim2.new(1, -10, 0, 70)
	img.Position = UDim2.new(0, 5, 0, 5)
	img.BackgroundTransparency = 1
	img.Parent = card

	local title = Instance.new("TextLabel")
	title.Text = data.title
	title.Font = Enum.Font.GothamBold
	title.TextScaled = true
	title.TextColor3 = Color3.fromRGB(255, 255, 255)
	title.BackgroundTransparency = 1
	title.Size = UDim2.new(1, -10, 0, 25)
	title.Position = UDim2.new(0, 5, 0, 80)
	title.Parent = card

	local copyBtn = Instance.new("TextButton")
	copyBtn.Text = "Copy Script"
	copyBtn.Font = Enum.Font.Gotham
	copyBtn.TextSize = 13
	copyBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
	copyBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	copyBtn.Size = UDim2.new(0.9, 0, 0, 25)
	copyBtn.Position = UDim2.new(0.05, 0, 1, -30)
	copyBtn.Parent = card

	local copyCorner = Instance.new("UICorner")
	copyCorner.CornerRadius = UDim.new(0, 6)
	copyCorner.Parent = copyBtn

	copyBtn.MouseButton1Click:Connect(function()
		setclipboard(data.text)
	end)
end

--// Spawn Cards
for _, scriptData in ipairs(scripts) do
	createScriptCard(scriptData)
end

--// Initial search filter (empty = show all)
searchBox.Text = ""
searchBox.Visible = false
searchButton.Visible = true

--// Ensure clicking click outside collapse works (mouse)
local UserInputService = game:GetService("UserInputService")
UserInputService.InputBegan:Connect(function(input, gpe)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		-- if searchBox visible and click outside searchBox, and search text empty -> collapse
		if searchBox.Visible then
			local mx, my = UserInputService:GetMouseLocation().X, UserInputService:GetMouseLocation().Y
			local absPos = searchBox.AbsolutePosition
			local absSize = searchBox.AbsoluteSize
			local inside = mx > absPos.X and mx < absPos.X + absSize.X and my > absPos.Y and my < absPos.Y + absSize.Y
			if not inside and searchBox.Text == "" then
				closeSearch()
			end
		end
	end
end)
